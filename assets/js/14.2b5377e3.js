(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{204:function(s,a,e){"use strict";e.r(a);var t=e(0),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"update-chain"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#update-chain","aria-hidden":"true"}},[s._v("#")]),s._v(" Update chain")]),s._v(" "),e("p",[e("strong",[s._v("IMPORTANT BEFORE YOU START")]),s._v(": If you are a new validator you need follow "),e("a",{attrs:{href:"##getting-started"}},[s._v('"Getting Started"')]),s._v(" procedure. "),e("strong",[s._v("DON'T USE THESE UPDATE PROCEDURES")])]),s._v(" "),e("p",[s._v("This section describe the procedures to update chain from a version to another."),e("br"),s._v("\nEvery update have a specific produre type."),e("br"),s._v("\nFirst type will be used only for testnet chains, while the second will be used to update mainnet chain."),e("br"),s._v("\nEvery chain starting "),e("code",[s._v("commercio-testnet3000")]),s._v(" contains type procedure adopted."),e("br"),s._v("\nIn")]),s._v(" "),e("p",[e("code",[s._v("https://github.com/commercionetwork/chains/blob/master/commercio-<chain-version>/.data")])]),s._v(" "),e("p",[s._v("You should find "),e("code",[s._v("Update type")]),s._v(".")]),s._v(" "),e("h2",{attrs:{id:"_1-update-with-getting-started-procedure"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-update-with-getting-started-procedure","aria-hidden":"true"}},[s._v("#")]),s._v(' 1. Update with "getting started" procedure')]),s._v(" "),e("p",[s._v('This type is similar to the "getting started" procedure.'),e("br"),s._v("\nYou need to delete or move the "),e("code",[s._v("~/.cnd")]),s._v(" folder and start as fresh."),e("br"),s._v("\nYou can mantain your wallet that is installed in "),e("code",[s._v("~/.cncli")]),s._v(" folder or in your "),e("code",[s._v("ledger")]),s._v(" device, or recreate it with mnemonic."),e("br"),s._v("\nYou can create new wallet if you prefered and use a new account to become a validator.")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl stop cnd\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("pkill")]),s._v(" cnd "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#We want be sure that chain process was stopped ;)")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("Delete "),e("code",[s._v("~/.cnd")]),s._v(" folder")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf ~/.cnd\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("or move it (if you want keep the old testnet state for your porpouses).\nUse "),e("code",[s._v("<previous-chain-version>")]),s._v(" name for copy name for example")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r ~/.cnd ~/.cnd."),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("previous-chain-version"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v('Now you can start follow "getting started" procedure.\n'),e("strong",[s._v("ATTENTION")]),s._v(': before go haed with "getting started" procedure read follow changes about some steps')]),s._v(" "),e("p",[s._v("In "),e("a",{attrs:{href:"##1-Setup"}},[e("code",[s._v("step 1")])]),s._v(" in order to update the OS so that you can work properly, execute the following commands:")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" upgrade -y\nsnap refresh --classic go "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# You need to update golang to last version")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("In "),e("a",{attrs:{href:"##4-install-binaries-genesis-file-and-setup-configuration"}},[e("code",[s._v("step 4")])]),s._v(" you don't need to change the follow rows of your "),e("code",[s._v("~/.profile")]),s._v(" file")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('export GOPATH="\\$HOME/go"\nexport PATH="\\$GOPATH/bin:\\$PATH"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("You need clean up your file from previous chain configurations")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n -e "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/export NODENAME=.*/d'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n -e "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/export CHAINID=.*/d'")]),s._v(" ~/.profile\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("and add new chain configs")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODENAME")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<your-moniker>"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CHAINID")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("commercio-"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" .data "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -oP "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Name\\s+\\K\\S+'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v("EOF "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" ~/.profile\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODENAME")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NODENAME")]),s._v('"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CHAINID")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CHAINID")]),s._v('"')]),s._v("\nEOF\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h2",{attrs:{id:"_2-update-with-cnd-commands-wip-ðŸ› "}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-update-with-cnd-commands-wip-ðŸ› ","aria-hidden":"true"}},[s._v("#")]),s._v(" 2. Update with cnd commands "),e("strong",[s._v("(WIP ðŸ› )")])]),s._v(" "),e("p",[s._v("This procedure will be applied to mainnet chain and to some specific testnet update")]),s._v(" "),e("h3",{attrs:{id:"a-preliminary-risks-wip-ðŸ› "}},[e("a",{staticClass:"header-anchor",attrs:{href:"#a-preliminary-risks-wip-ðŸ› ","aria-hidden":"true"}},[s._v("#")]),s._v(" A. Preliminary/Risks "),e("strong",[s._v("(WIP ðŸ› )")])]),s._v(" "),e("p",[s._v("To this type of procedure will be assigned a height of block, informations about checksum of geneis file and software version and a deadline expressed in UTC format."),e("br"),s._v("\nThere is some risks about double signature: to avoid every sort of risks verify software and hash of "),e("code",[s._v("genesis.json")]),s._v(" and specific configuration in "),e("code",[s._v("config.toml")]),s._v(".\nThe deadline of update must be respected: every validator that will not update just in time will be slashed.")]),s._v(" "),e("h3",{attrs:{id:"b-recovery-wip-ðŸ› "}},[e("a",{staticClass:"header-anchor",attrs:{href:"#b-recovery-wip-ðŸ› ","aria-hidden":"true"}},[s._v("#")]),s._v(" B. Recovery "),e("strong",[s._v("(WIP ðŸ› )")])]),s._v(" "),e("p",[s._v("Is recommended to take a full data snapshot at the export height before update."),e("br"),s._v("\nThis procedure is quite simple using commands below")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl stop cnd\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r ~/.cnd ~/.cnd."),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OLD VERSION"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r ~/.cncli ~/.cncli."),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OLD VERSION"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Save binaries also")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r /root/go/bin/cnd /root/go/bin/cnd."),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OLD VERSION"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r /root/go/bin/cncli /root/go/bin/cncli."),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OLD VERSION"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h3",{attrs:{id:"c-upgrade-procedure-wip-ðŸ› "}},[e("a",{staticClass:"header-anchor",attrs:{href:"#c-upgrade-procedure-wip-ðŸ› ","aria-hidden":"true"}},[s._v("#")]),s._v(" C. Upgrade Procedure "),e("strong",[s._v("(WIP ðŸ› )")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf commercio-chains\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" commercio-chains "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" commercio-chains\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/commercionetwork/chains.git "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" commercio-"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("chain-version"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# eg. cd commercio-testnet1001 ")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("Compile binaries")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" init "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" \n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" remote "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" origin https://github.com/commercionetwork/commercionetwork.git\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" pull\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" checkout tags/"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" .data "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -oP "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Release\\s+\\K\\S+'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("Test if you have the correct binaries version:")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("cnd version\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Should output the same version written inside the .data file")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("Get height from update info")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BLOCKHEIGHT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" .data "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -oP "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Height\\s+\\K\\S+'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("Export state from")])])}),[],!1,null,null,null);a.default=n.exports}}]);