<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Updating a validator | Commercio.network Documentation</title>
    <meta name="description" content="Documentation for the Commercio.network blockchain.">
    
    
    <link rel="preload" href="/assets/css/0.styles.8ce8701a.css" as="style"><link rel="preload" href="/assets/js/app.81011c92.js" as="script"><link rel="preload" href="/assets/js/2.2cd5844a.js" as="script"><link rel="preload" href="/assets/js/14.be39ba34.js" as="script"><link rel="prefetch" href="/assets/js/10.ef61a45b.js"><link rel="prefetch" href="/assets/js/11.270d1ab4.js"><link rel="prefetch" href="/assets/js/12.aa14c9c7.js"><link rel="prefetch" href="/assets/js/13.545d5934.js"><link rel="prefetch" href="/assets/js/15.64db8ae2.js"><link rel="prefetch" href="/assets/js/16.7a8aabd8.js"><link rel="prefetch" href="/assets/js/17.ee06af48.js"><link rel="prefetch" href="/assets/js/18.31c51cff.js"><link rel="prefetch" href="/assets/js/19.6e5cb760.js"><link rel="prefetch" href="/assets/js/20.795754ea.js"><link rel="prefetch" href="/assets/js/21.a4081a86.js"><link rel="prefetch" href="/assets/js/22.02a008ff.js"><link rel="prefetch" href="/assets/js/23.bd468e87.js"><link rel="prefetch" href="/assets/js/24.9a1062fe.js"><link rel="prefetch" href="/assets/js/25.94f05293.js"><link rel="prefetch" href="/assets/js/26.65d62c13.js"><link rel="prefetch" href="/assets/js/27.a1619765.js"><link rel="prefetch" href="/assets/js/28.73edfa05.js"><link rel="prefetch" href="/assets/js/29.7166024a.js"><link rel="prefetch" href="/assets/js/3.d5c3e05f.js"><link rel="prefetch" href="/assets/js/4.8a6f08e8.js"><link rel="prefetch" href="/assets/js/5.b3781f89.js"><link rel="prefetch" href="/assets/js/6.f5b93b7f.js"><link rel="prefetch" href="/assets/js/7.d61e85cb.js"><link rel="prefetch" href="/assets/js/8.928118f1.js"><link rel="prefetch" href="/assets/js/9.737abafb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8ce8701a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Commercio.network Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://commercio.network" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Commercio.network
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/commercionetwork/commercionetwork" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://commercio.network" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Commercio.network
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/commercionetwork/commercionetwork" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Nodes</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/nodes/" class="sidebar-link">Introduction</a></li><li><a href="/nodes/hardware-requirements.html" class="sidebar-link">Hardware requirements</a></li><li><a href="/nodes/full-node-installation.html" class="sidebar-link">Installing a full node</a></li><li><a href="/nodes/validator-node-installation.html" class="sidebar-link">Becoming a validator</a></li><li><a href="/nodes/validator-node-update.html" class="active sidebar-link">Updating a validator</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nodes/validator-node-update.html#update-type-1-hard-fork" class="sidebar-link">Update type 1 - Hard fork</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nodes/validator-node-update.html#_1-wipe-the-current-chain-state" class="sidebar-link">1. Wipe the current chain state</a></li><li class="sidebar-sub-header"><a href="/nodes/validator-node-update.html#_2-start-a-new-chain" class="sidebar-link">2. Start a new chain</a></li></ul></li><li class="sidebar-sub-header"><a href="/nodes/validator-node-update.html#update-type-2-soft-fork" class="sidebar-link">Update type 2 - Soft fork</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nodes/validator-node-update.html#preliminary-risks" class="sidebar-link">Preliminary/Risks</a></li><li class="sidebar-sub-header"><a href="/nodes/validator-node-update.html#backup" class="sidebar-link">Backup</a></li><li class="sidebar-sub-header"><a href="/nodes/validator-node-update.html#update-procedure" class="sidebar-link">Update procedure</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Developers</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/developers/" class="sidebar-link">Introduction</a></li><li><a href="/developers/create-sign-broadcast-tx.html" class="sidebar-link">Create, sign and send a transaction</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Modules</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/x/government/" class="sidebar-link">Chain government</a></li><li><a href="/x/docs/" class="sidebar-link">CommercioDOCS</a></li><li><a href="/x/id/" class="sidebar-link">CommercioID</a></li></ul></section></li><li><a href="/chain-start/" class="sidebar-link">Starting a local chain</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="updating-a-validator"><a href="#updating-a-validator" aria-hidden="true" class="header-anchor">#</a> Updating a validator</h1> <div class="danger custom-block"><p>If you are a new validator you need follow the <a href="/nodes/validator-node-installation.html"><em>&quot;Becoming a validator&quot;</em> procedure</a>.<br> <strong>DO NOT USE THIS UPDATE PROCEDURES</strong></p></div> <p>This section describes the procedure that needs to be followed in order to update a validator node from one
version to another.</p> <p>Please note that each chain version has an update type associated to it.
In order to know which one is associated to the chain version you are currently running, please do the following:</p> <ol><li>Go to our <a href="https://github.com/commercionetwork/chains" target="_blank" rel="noopener noreferrer">chains repo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>Enter the folder of you current chain's version</li> <li>Open the <code>.data</code> file</li> <li>Read the  value associated to the <code>Update type</code> field.</li></ol> <p>Once you know the update type, please follow the related procedure:</p> <ul><li>Update type <a href="#update-type-1---hard-fork"><code>1 - Hard fork</code></a></li> <li>Update type <a href="#update-type-2---soft-fork"><code>2 - Soft fork</code></a></li></ul> <h2 id="update-type-1-hard-fork"><a href="#update-type-1-hard-fork" aria-hidden="true" class="header-anchor">#</a> Update type 1 - Hard fork</h2> <p>The procedure to follow in order to upgrade the chain using this update type is very similar to the
<a href="/nodes/validator-node-installation.html">installation procedure</a>.</p> <p>Due to this procedure being a <strong>hard fork</strong>, this means that any of the current chain data will be completely wiped
and a new chain will start from scratch. However, if you want you can create a copy of the current chain state in order
to use it for testing purposes.</p> <h3 id="_1-wipe-the-current-chain-state"><a href="#_1-wipe-the-current-chain-state" aria-hidden="true" class="header-anchor">#</a> 1. Wipe the current chain state</h3> <p>To start the procedure we need to kill the service running the chain:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>systemctl stop cnd
<span class="token function">pkill</span> cnd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Now, we need to wipe the chain state. In order to do so, you have two options:</p> <ol><li>Backup your data<br> <code>cp -r ~/.cnd ~/.cnd.back</code></li> <li>Delete the data without a backup
<code>rm -rf ~/.cnd</code></li></ol> <h3 id="_2-start-a-new-chain"><a href="#_2-start-a-new-chain" aria-hidden="true" class="header-anchor">#</a> 2. Start a new chain</h3> <p>Once you have properly cleaned up the previous chain state, you are ready to start the new chain version.<br>
To do so, please refer to the <a href="/nodes/full-node-installation.html">full node installation guide</a> but remember to apply the
following changes to the procedure described there:</p> <p><strong>1.</strong> Inside the <a href="/nodes/full-node-installation.html#1-installing-the-software-requirements">first step</a>
in order to update the OS so that you can work properly execute the following commands:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt</span> upgrade -y
snap refresh --classic go
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>2.</strong> During the <a href="/nodes/full-node-installation.html#3-install-binaries-genesis-file-and-setup-configuration">4th step</a>
you don't need to change the follow rows of your <code>~/.profile</code> file</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">GOPATH</span><span class="token operator">=</span><span class="token string">&quot;\<span class="token environment constant">$HOME</span>/go&quot;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token string">&quot;\<span class="token variable">$GOPATH</span>/bin:\<span class="token environment constant">$PATH</span>&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>You also need to clean up the files from the previous chain configurations</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sed</span> -i <span class="token punctuation">\</span>
-e <span class="token string">'/export NODENAME=.*/d'</span> <span class="token punctuation">\</span>
-e <span class="token string">'/export CHAINID=.*/d'</span> ~/.profile
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>and add the new chain ones</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">NODENAME</span><span class="token operator">=</span><span class="token string">&quot;&lt;your-moniker&gt;&quot;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CHAINID</span><span class="token operator">=</span>commercio-<span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> .data <span class="token operator">|</span> <span class="token function">grep</span> -oP <span class="token string">'Name\s+\K\S+'</span><span class="token variable">)</span></span>

<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span>EOF <span class="token operator">&gt;&gt;</span> ~/.profile
<span class="token builtin class-name">export</span> <span class="token assign-left variable">NODENAME</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$NODENAME</span>&quot;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CHAINID</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$CHAINID</span>&quot;</span>
EOF
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="update-type-2-soft-fork"><a href="#update-type-2-soft-fork" aria-hidden="true" class="header-anchor">#</a> Update type 2 - Soft fork</h2> <p>The second update type is the one known as <strong>soft fork</strong>.<br>
In this case, the chain state will be preserved from its beginning to a certain point in time.</p> <h3 id="preliminary-risks"><a href="#preliminary-risks" aria-hidden="true" class="header-anchor">#</a> Preliminary/Risks</h3> <p>When signalling a required update that should follow this procedure, the following information will
be let known to all validators:</p> <ol><li>A specific block height</li> <li>The genesis file checksum</li> <li>The new chain software version</li> <li>A deadline expressed in UTC format</li></ol> <p>If you are a validator, please make sure that you know all those information before proceeding with the update.</p> <div class="danger custom-block"><p class="custom-block-title">Double signing</p> <p>Due to the nature of the update operations, there is some risk of double signature.
To avoid every sort of risks please verify the software version, the hash of the <code>genesis.json</code> file and the specific
configuration present inside the <code>config.toml</code> file.</p></div> <div class="danger custom-block"><p class="custom-block-title">Update time</p> <p>The deadline of the update must be respected: every validator that will not update just in time will be slashed.</p></div> <h3 id="backup"><a href="#backup" aria-hidden="true" class="header-anchor">#</a> Backup</h3> <p>Before starting the update it ss recommended to take a full data snapshot of the chain state at the export height.<br>
To do so please run:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>systemctl stop cnd
<span class="token function">cp</span> -r ~/.cnd ~/.cnd.back
<span class="token function">cp</span> -r ~/.cncli ~/.cncli.back
<span class="token function">cp</span> -r /root/go/bin/cnd /root/go/bin/cnd.back
<span class="token function">cp</span> -r /root/go/bin/cncli /root/go/bin/cncli.back
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="update-procedure"><a href="#update-procedure" aria-hidden="true" class="header-anchor">#</a> Update procedure</h3> <h4 id="_1-updating-the-software"><a href="#_1-updating-the-software" aria-hidden="true" class="header-anchor">#</a> 1. Updating the software</h4> <p>In order to properly update your validator node, first of all you need to clone the
<a href="https://github.com/commercionetwork/chains" target="_blank" rel="noopener noreferrer"><code>chains</code> repo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">rm</span> -rf commercio-chains
<span class="token function">mkdir</span> commercio-chains <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> commercio-chains
<span class="token function">git</span> clone https://github.com/commercionetwork/chains.git <span class="token builtin class-name">.</span>
<span class="token builtin class-name">cd</span> commercio-<span class="token operator">&lt;</span>chain-version<span class="token operator">&gt;</span> <span class="token comment"># eg. cd commercio-testnet3000 </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Once downloaded, you need to compile the binaries:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">git</span> init <span class="token builtin class-name">.</span> 
<span class="token function">git</span> remote <span class="token function">add</span> origin https://github.com/commercionetwork/commercionetwork.git
<span class="token function">git</span> pull
<span class="token function">git</span> checkout tags/<span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> .data <span class="token operator">|</span> <span class="token function">grep</span> -oP <span class="token string">'Release\s+\K\S+'</span><span class="token variable">)</span></span>
<span class="token function">make</span> <span class="token function">install</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>After the compilation has finished successfully, please make sure you are running the correct software version:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>cnd version
<span class="token comment"># Should output the same version written inside the .data file</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_2-export-the-chain-state-wip"><a href="#_2-export-the-chain-state-wip" aria-hidden="true" class="header-anchor">#</a> 2. Export the chain state (<strong>WIP</strong>)</h4> <p>Once the software has properly been updated, we need to export the current chain state and later import it.<br>
In order to do so, first of all you need to get the export height from the <code>.data</code> file:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">BLOCKHEIGHT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> .data <span class="token operator">|</span> <span class="token function">grep</span> -oP <span class="token string">'Height\s+\K\S+'</span><span class="token variable">)</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>WIP</strong></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/commercionetwork/commercionetwork/edit/master/docs/nodes/validator-node-update.md" target="_blank" rel="noopener noreferrer">Edit this page on Github</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">9/19/2019, 9:28:31 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/nodes/validator-node-installation.html" class="prev">
          Becoming a validator
        </a></span> <span class="next"><a href="/developers/">
          Introduction
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.81011c92.js" defer></script><script src="/assets/js/2.2cd5844a.js" defer></script><script src="/assets/js/14.be39ba34.js" defer></script>
  </body>
</html>
