<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Update chain | Commercio.network Documentation</title>
    <meta name="description" content="Documentation for the Commercio.network blockchain.">
    
    
    <link rel="preload" href="/assets/css/0.styles.8ce8701a.css" as="style"><link rel="preload" href="/assets/js/app.82732994.js" as="script"><link rel="preload" href="/assets/js/2.2cd5844a.js" as="script"><link rel="preload" href="/assets/js/14.2b5377e3.js" as="script"><link rel="prefetch" href="/assets/js/10.765026c9.js"><link rel="prefetch" href="/assets/js/11.e9f1358d.js"><link rel="prefetch" href="/assets/js/12.13df9a7e.js"><link rel="prefetch" href="/assets/js/13.0367c139.js"><link rel="prefetch" href="/assets/js/15.1e70aabe.js"><link rel="prefetch" href="/assets/js/16.305736d8.js"><link rel="prefetch" href="/assets/js/17.1e6eeb80.js"><link rel="prefetch" href="/assets/js/18.a603cd92.js"><link rel="prefetch" href="/assets/js/19.12b02d75.js"><link rel="prefetch" href="/assets/js/20.4bddd626.js"><link rel="prefetch" href="/assets/js/21.4fbe68eb.js"><link rel="prefetch" href="/assets/js/22.111305a8.js"><link rel="prefetch" href="/assets/js/23.8efec9f9.js"><link rel="prefetch" href="/assets/js/24.30b81104.js"><link rel="prefetch" href="/assets/js/25.f3ea6fc8.js"><link rel="prefetch" href="/assets/js/26.7f9da2f6.js"><link rel="prefetch" href="/assets/js/27.326422a2.js"><link rel="prefetch" href="/assets/js/28.3cd5c2bd.js"><link rel="prefetch" href="/assets/js/3.c3e58d27.js"><link rel="prefetch" href="/assets/js/4.8a6f08e8.js"><link rel="prefetch" href="/assets/js/5.03103d32.js"><link rel="prefetch" href="/assets/js/6.0312e696.js"><link rel="prefetch" href="/assets/js/7.6cdf6dd8.js"><link rel="prefetch" href="/assets/js/8.0c85a55c.js"><link rel="prefetch" href="/assets/js/9.94ad05a5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8ce8701a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Commercio.network Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://commercio.network" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Commercio.network
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/commercionetwork/commercionetwork" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://commercio.network" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Commercio.network
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/commercionetwork/commercionetwork" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Nodes</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/nodes/" class="sidebar-link">Introduction</a></li><li><a href="/nodes/hardware-requirements.html" class="sidebar-link">Hardware requirements</a></li><li><a href="/nodes/full-node-installation.html" class="sidebar-link">Installing a full node</a></li><li><a href="/nodes/validator-node-installation.html" class="sidebar-link">Becoming a validator</a></li><li><a href="/nodes/validator-node-update.html" class="active sidebar-link">Updating a validator</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nodes/validator-node-update.html#_1-update-with-getting-started-procedure" class="sidebar-link">1. Update with &quot;getting started&quot; procedure</a></li><li class="sidebar-sub-header"><a href="/nodes/validator-node-update.html#_2-update-with-cnd-commands-wip-🛠" class="sidebar-link">2. Update with cnd commands (WIP 🛠)</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Developers</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/developers/" class="sidebar-link">Introduction</a></li><li><a href="/developers/create-sign-broadcast-tx.html" class="sidebar-link">Create, sign and send a transaction</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Modules</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/x/government/" class="sidebar-link">Chain government</a></li><li><a href="/x/docs/" class="sidebar-link">CommercioDOCS</a></li><li><a href="/x/id/" class="sidebar-link">CommercioID</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="update-chain"><a href="#update-chain" aria-hidden="true" class="header-anchor">#</a> Update chain</h1> <p><strong>IMPORTANT BEFORE YOU START</strong>: If you are a new validator you need follow <a href="##getting-started">&quot;Getting Started&quot;</a> procedure. <strong>DON'T USE THESE UPDATE PROCEDURES</strong></p> <p>This section describe the procedures to update chain from a version to another.<br>
Every update have a specific produre type.<br>
First type will be used only for testnet chains, while the second will be used to update mainnet chain.<br>
Every chain starting <code>commercio-testnet3000</code> contains type procedure adopted.<br>
In</p> <p><code>https://github.com/commercionetwork/chains/blob/master/commercio-&lt;chain-version&gt;/.data</code></p> <p>You should find <code>Update type</code>.</p> <h2 id="_1-update-with-getting-started-procedure"><a href="#_1-update-with-getting-started-procedure" aria-hidden="true" class="header-anchor">#</a> 1. Update with &quot;getting started&quot; procedure</h2> <p>This type is similar to the &quot;getting started&quot; procedure.<br>
You need to delete or move the <code>~/.cnd</code> folder and start as fresh.<br>
You can mantain your wallet that is installed in <code>~/.cncli</code> folder or in your <code>ledger</code> device, or recreate it with mnemonic.<br>
You can create new wallet if you prefered and use a new account to become a validator.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>systemctl stop cnd
<span class="token function">pkill</span> cnd <span class="token comment">#We want be sure that chain process was stopped ;)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Delete <code>~/.cnd</code> folder</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">rm</span> -rf ~/.cnd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>or move it (if you want keep the old testnet state for your porpouses).
Use <code>&lt;previous-chain-version&gt;</code> name for copy name for example</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">cp</span> -r ~/.cnd ~/.cnd.<span class="token operator">&lt;</span>previous-chain-version<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Now you can start follow &quot;getting started&quot; procedure.
<strong>ATTENTION</strong>: before go haed with &quot;getting started&quot; procedure read follow changes about some steps</p> <p>In <a href="##1-Setup"><code>step 1</code></a> in order to update the OS so that you can work properly, execute the following commands:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt</span> upgrade -y
snap refresh --classic go <span class="token comment"># You need to update golang to last version</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>In <a href="##4-install-binaries-genesis-file-and-setup-configuration"><code>step 4</code></a> you don't need to change the follow rows of your <code>~/.profile</code> file</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>export GOPATH=&quot;\$HOME/go&quot;
export PATH=&quot;\$GOPATH/bin:\$PATH&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>You need clean up your file from previous chain configurations</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sed</span> -i <span class="token punctuation">\</span>
 -e <span class="token string">'/export NODENAME=.*/d'</span> <span class="token punctuation">\</span>
 -e <span class="token string">'/export CHAINID=.*/d'</span> ~/.profile
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>and add new chain configs</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">NODENAME</span><span class="token operator">=</span><span class="token string">&quot;&lt;your-moniker&gt;&quot;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CHAINID</span><span class="token operator">=</span>commercio-<span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> .data <span class="token operator">|</span> <span class="token function">grep</span> -oP <span class="token string">'Name\s+\K\S+'</span><span class="token variable">)</span></span>

<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span>EOF <span class="token operator">&gt;&gt;</span> ~/.profile
<span class="token builtin class-name">export</span> <span class="token assign-left variable">NODENAME</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$NODENAME</span>&quot;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CHAINID</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$CHAINID</span>&quot;</span>
EOF
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="_2-update-with-cnd-commands-wip-🛠"><a href="#_2-update-with-cnd-commands-wip-🛠" aria-hidden="true" class="header-anchor">#</a> 2. Update with cnd commands <strong>(WIP 🛠)</strong></h2> <p>This procedure will be applied to mainnet chain and to some specific testnet update</p> <h3 id="a-preliminary-risks-wip-🛠"><a href="#a-preliminary-risks-wip-🛠" aria-hidden="true" class="header-anchor">#</a> A. Preliminary/Risks <strong>(WIP 🛠)</strong></h3> <p>To this type of procedure will be assigned a height of block, informations about checksum of geneis file and software version and a deadline expressed in UTC format.<br>
There is some risks about double signature: to avoid every sort of risks verify software and hash of <code>genesis.json</code> and specific configuration in <code>config.toml</code>.
The deadline of update must be respected: every validator that will not update just in time will be slashed.</p> <h3 id="b-recovery-wip-🛠"><a href="#b-recovery-wip-🛠" aria-hidden="true" class="header-anchor">#</a> B. Recovery <strong>(WIP 🛠)</strong></h3> <p>Is recommended to take a full data snapshot at the export height before update.<br>
This procedure is quite simple using commands below</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>systemctl stop cnd
<span class="token function">cp</span> -r ~/.cnd ~/.cnd.<span class="token punctuation">[</span>OLD VERSION<span class="token punctuation">]</span>
<span class="token function">cp</span> -r ~/.cncli ~/.cncli.<span class="token punctuation">[</span>OLD VERSION<span class="token punctuation">]</span>
<span class="token comment"># Save binaries also</span>
<span class="token function">cp</span> -r /root/go/bin/cnd /root/go/bin/cnd.<span class="token punctuation">[</span>OLD VERSION<span class="token punctuation">]</span>
<span class="token function">cp</span> -r /root/go/bin/cncli /root/go/bin/cncli.<span class="token punctuation">[</span>OLD VERSION<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="c-upgrade-procedure-wip-🛠"><a href="#c-upgrade-procedure-wip-🛠" aria-hidden="true" class="header-anchor">#</a> C. Upgrade Procedure <strong>(WIP 🛠)</strong></h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">rm</span> -rf commercio-chains
<span class="token function">mkdir</span> commercio-chains <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> commercio-chains
<span class="token function">git</span> clone https://github.com/commercionetwork/chains.git <span class="token builtin class-name">.</span>
<span class="token builtin class-name">cd</span> commercio-<span class="token operator">&lt;</span>chain-version<span class="token operator">&gt;</span> <span class="token comment"># eg. cd commercio-testnet1001 </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Compile binaries</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">git</span> init <span class="token builtin class-name">.</span> 
<span class="token function">git</span> remote <span class="token function">add</span> origin https://github.com/commercionetwork/commercionetwork.git
<span class="token function">git</span> pull
<span class="token function">git</span> checkout tags/<span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> .data <span class="token operator">|</span> <span class="token function">grep</span> -oP <span class="token string">'Release\s+\K\S+'</span><span class="token variable">)</span></span>
<span class="token function">make</span> <span class="token function">install</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Test if you have the correct binaries version:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>cnd version
<span class="token comment"># Should output the same version written inside the .data file</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Get height from update info</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">BLOCKHEIGHT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> .data <span class="token operator">|</span> <span class="token function">grep</span> -oP <span class="token string">'Height\s+\K\S+'</span><span class="token variable">)</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Export state from</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/commercionetwork/commercionetwork/edit/master/docs/nodes/validator-node-update.md" target="_blank" rel="noopener noreferrer">Edit this page on Github</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">9/18/2019, 1:46:53 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/nodes/validator-node-installation.html" class="prev">
          Becoming a validator
        </a></span> <span class="next"><a href="/developers/">
          Introduction
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.82732994.js" defer></script><script src="/assets/js/2.2cd5844a.js" defer></script><script src="/assets/js/14.2b5377e3.js" defer></script>
  </body>
</html>
